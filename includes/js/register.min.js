function rcp_validate_form(e){rcp_validate_subscription_level(),e&&rcp_validate_gateways(),rcp_validate_discount()}function rcp_validate_subscription_level(){if(!rcp_validating_level){var e=jQuery,r=!1,a=e("#rcp_subscription_levels input:checked"),t=e(".rcp_gateway_fields").hasClass("rcp_discounted_100"),_="forever"==a.data("duration"),c=-1!==rcp_script_options.trial_levels.indexOf(a.val());rcp_validating_level=!0,0==a.attr("rel")&&(r=!0),r?(e(".rcp_gateway_fields,#rcp_auto_renew_wrap,#rcp_discount_code_wrap").hide(),e(".rcp_gateway_fields").removeClass("rcp_discounted_100"),e("#rcp_discount_code_wrap input").val(""),e(".rcp_discount_amount,#rcp_gateway_extra_fields").remove(),e(".rcp_discount_valid, .rcp_discount_invalid").hide(),e("#rcp_auto_renew_wrap input").prop("checked",!1)):(t?e("#rcp_gateway_extra_fields").remove():_?(e("#rcp_auto_renew_wrap input").prop("checked",!1),e("#rcp_auto_renew_wrap").hide()):e(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),c&&(e("#rcp_auto_renew_wrap input").prop("checked",!0),e("#rcp_auto_renew_wrap").hide()),e("#rcp_discount_code_wrap").show()),rcp_validating_level=!1}}function rcp_get_gateway(){var e,r=jQuery;return r("#rcp_payment_gateways").length>0?(e=r("#rcp_payment_gateways select option:selected")).length<1&&(e=r('input[name="rcp_gateway"]:checked')):e=r('input[name="rcp_gateway"]'),e}function rcp_validate_gateways(){if(!rcp_validating_gateway){var e=jQuery,r=e("#rcp_registration_form"),a=!1;if(!(t=e("#rcp_subscription_levels input:checked")).val())var t=e('#rcp_submit_wrap input[name="rcp_level"]');var _=e(".rcp_gateway_fields").hasClass("rcp_discounted_100"),c="forever"==t.data("duration"),i=-1!==rcp_script_options.trial_levels.indexOf(t.val()),p=rcp_get_gateway();if(rcp_validating_gateway=!0,0==t.attr("rel")&&(a=!0),e(".rcp_message.error",r).remove(),a)e(".rcp_gateway_fields").hide(),e("#rcp_gateway_extra_fields").remove();else{if(_)e("#rcp_gateway_extra_fields").remove();else{r.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),e(".rcp_gateway_fields").show();var o={action:"rcp_load_gateway_fields",rcp_gateway:p.val()};e.post(rcp_script_options.ajaxurl,o,function(a){e("#rcp_gateway_extra_fields").remove(),a.success&&a.data.fields&&(e(".rcp_gateway_fields").length?e('<div class="rcp_gateway_'+p.val()+'_fields" id="rcp_gateway_extra_fields">'+a.data.fields+"</div>").insertAfter(".rcp_gateway_fields"):e('<div class="rcp_gateway_'+p.val()+'_fields" id="rcp_gateway_extra_fields">'+a.data.fields+"</div>").insertAfter(".rcp_gateways_fieldset")),r.unblock()})}"yes"==p.data("supports-recurring")?(e("#rcp_auto_renew_wrap input").prop("checked",rcp_script_options.auto_renew_default),e("#rcp_auto_renew_wrap").show(),(_||c||a)&&(e("#rcp_auto_renew_wrap input").prop("checked",!1),e("#rcp_auto_renew_wrap").hide()),i&&"yes"==p.data("supports-trial")&&!rcp_script_options.user_has_trialed&&(e("#rcp_auto_renew_wrap input").prop("checked",!0),e("#rcp_auto_renew_wrap").hide())):(e("#rcp_auto_renew_wrap input").prop("checked",!1),e("#rcp_auto_renew_wrap").hide()),e("#rcp_discount_code_wrap").show()}rcp_validating_gateway=!1}}function rcp_validate_discount(){if(!rcp_validating_discount){var e=jQuery,r=e(".rcp_gateway_fields"),a=e("#rcp_discount_code").val(),t=!1;if(0==e("#rcp_subscription_levels input:checked").attr("rel")&&(t=!0),e("#rcp_subscription_levels input:checked").length)_=e("#rcp_subscription_levels input:checked").val();else var _=e('input[name="rcp_level"]').val();if(!a)return e(".rcp_discount_valid, .rcp_discount_invalid").hide(),t?e("#rcp_auto_renew_wrap").hide():e("#rcp_auto_renew_wrap").show(),r.show().removeClass("rcp_discounted_100"),void rcp_validate_gateways();var c={action:"validate_discount",code:a,subscription_id:_};rcp_validating_discount=!0,e.post(rcp_script_options.ajaxurl,c,function(a){e(".rcp_discount_amount").remove(),e(".rcp_discount_valid, .rcp_discount_invalid").hide(),a.valid?a.valid&&(e(".rcp_discount_valid").show(),e("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+a.amount+"</span>"),a.full?(e("#rcp_auto_renew_wrap").hide(),r.hide().addClass("rcp_discounted_100"),e("#rcp_gateway_extra_fields").remove()):(e("#rcp_auto_renew_wrap").show(),r.show().removeClass("rcp_discounted_100"),rcp_validate_gateways())):(e(".rcp_discount_invalid").show(),r.removeClass("rcp_discounted_100"),e(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),rcp_validate_gateways()),rcp_validating_discount=!1,e("body").trigger("rcp_discount_applied",[a])})}}function rcp_calc_total(){var e=jQuery,r=e(".rcp_registration_total"),a=e("#rcp_discount_code").val(),t=e("#rcp_subscription_levels input:checked").length?e("#rcp_subscription_levels input:checked").val():e('input[name="rcp_level"]').val(),_=rcp_get_gateway();if(r.length){rcp_calculating_total=!0;var c={action:"rcp_calc_discount",rcp_level:t,rcp_discount:a,rcp_gateway:_.val()};e("#rcp_auto_renew").is(":checked")&&(c.rcp_auto_renew=!0),e.post(rcp_script_options.ajaxurl,c,function(e){rcp_calculating_total=!1,void 0!==e.total&&r.html(e.total)})}}function rcp_validate_recaptcha(e){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!1)}var rcp_validating_discount=!1,rcp_validating_gateway=!1,rcp_validating_level=!1,rcp_processing=!1,rcp_calculating_total=!1,gateway_submits_form=!1;jQuery(document).ready(function(e){rcp_validate_form(!0),rcp_calc_total(),e("#rcp_payment_gateways select, #rcp_payment_gateways input").change(function(){e("body").trigger("rcp_gateway_change")}),e(".rcp_level").change(function(){e("body").trigger("rcp_level_change")}),e("body").on("rcp_gateway_change",function(){rcp_validate_form(!0)}).on("rcp_level_change",function(){rcp_validate_form(!0)}),e("#rcp_apply_discount").on("click",function(r){r.preventDefault(),e("body").trigger("rcp_discount_change"),rcp_validate_discount()}),e(document.getElementById("rcp_auto_renew")).on("change",rcp_calc_total),e("body").on("rcp_discount_change rcp_level_change rcp_gateway_change",rcp_calc_total),"1"===rcp_script_options.recaptcha_enabled&&jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!0),e(document).on("click","#rcp_registration_form #rcp_submit",function(r){r.preventDefault();var a=document.getElementById("rcp_registration_form"),t=e("#rcp_registration_form");t.attr("id");if("function"!=typeof a.checkValidity||!1!==a.checkValidity()){e(this).val();t.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),e("#rcp_submit",t).val(rcp_script_options.pleasewait),rcp_processing||(rcp_processing=!0,e.post(rcp_script_options.ajaxurl,t.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(r){e(".rcp-submit-ajax",t).remove(),e(".rcp_message.error",t).remove()}).success(function(e){}).done(function(e){}).fail(function(e){console.log(e)}).always(function(e){}))}}),e(document).ajaxComplete(function(r,a,t){if(t.hasOwnProperty("data")&&-1!==t.data.indexOf("rcp_process_register_form")&&a.hasOwnProperty("responseJSON")&&a.responseJSON.hasOwnProperty("data")){if(!0!==a.responseJSON.data.success)return e("#rcp_registration_form #rcp_submit").val(rcp_script_options.register),e("#rcp_registration_form #rcp_submit").before(a.responseJSON.data.errors),e("#rcp_registration_form #rcp_register_nonce").val(a.responseJSON.data.nonce),e("#rcp_registration_form").unblock(),void(rcp_processing=!1);gateway_submits_form=!(!a.responseJSON.data.gateway.supports||-1===a.responseJSON.data.gateway.supports.indexOf("gateway-submits-form")),e("body").trigger("rcp_register_form_submission",[a.responseJSON.data,r.target.forms.rcp_registration_form.id]),0!=a.responseJSON.data.total&&gateway_submits_form||document.getElementById("rcp_registration_form").submit()}})});